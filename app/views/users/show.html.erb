<%= form_tag(user_path,:method => 'get') do %>
<%= select_tag 'year',options_for_select([[2021,2021],[2022,2022],[2023,2023],[2024,2024],[2025,2025],[2026,2026],[2027,2027],[2028,2028],[2029,2029],[2030,2030]],params[:year] ||= Date.today.year)%>
<%= select_tag 'month',options_for_select([[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7],[8,8],[9,9],[10,10],[11,11],[12,12]],params[:month] ||= Date.today.month) %>
<%= submit_tag 'Search', :name => nil %>
<% end %>

<%="#{@user.name}さんの#{params[:year] ||= Date.today.year}年#{params[:month] ||= Date.today.month}月の合計勤務時間は#{@current_month_working_times[0]}h#{@current_month_working_times[1]}mです"%>
<%="合計時間外労働は#{@current_month_overtime_hours[0]}h#{@current_month_overtime_hours[1]}mです"%>
<%= link_to 'Exel出力', user_path(format: :xlsx), data: {confirm: "Excel出力しますか？"}, class: 'btn btn-primary' %>
<table class="table table-bordered.table-condensed">
  <thead>
    <tr>
      <th>月</th>
      <th>日</th>
      <th>曜日</th>
      <th>勤務地</th>
      <th>出勤時刻</th>
      <th>退勤時刻</th>
      <th>勤務時間</th>
      <th>早出</th>
      <th>遅退</th>
      <th>時間外労働</th>
      <th>休憩時間</th>
      <th></th>
      </tr>
  </thead>
  <%@attendances.each do |attendance|%>
  <% working_times = attendance.working_times.divmod(60) if attendance.working_times %>
  <% overtime_hours = attendance.overtime_hours.divmod(60) if attendance.overtime_hours %>
  <% early_attendance = attendance.early_attendance.divmod(60) if attendance.early_attendance %>
  <% late_leaving = attendance.late_leaving.divmod(60) if attendance.late_leaving %>
  <% rest_times = attendance.rest_times.divmod(60)%>
  <tbody>
    <tr>
      <td><%="#{attendance.month}月"%></td>
      <td><%="#{attendance.day}日"%></td>
      <td><%="#{attendance.wday}曜日"%></td>
      <td><%=attendance.working_place%></td>
      <td><%=attendance.attendance_time.strftime("%H:%M")%></td>
      <td><%=attendance.leaving_time.strftime("%H:%M")%></td>
      <td><%="#{working_times[0]}h#{working_times[1]}m" if attendance.working_times%></td>
      <td><%="#{early_attendance[0]}h#{early_attendance[1]}m" if attendance.early_attendance%></td>
      <td><%="#{late_leaving[0]}h#{late_leaving[1]}m" if attendance.late_leaving%></td>
      <td><%="#{overtime_hours[0]}h#{overtime_hours[1]}m" if attendance.overtime_hours%></td>
      <td><%="#{rest_times[0]}h#{rest_times[1]}m" if attendance.rest_times%></td>
      <td><%=link_to "編集","/attendances/#{attendance.id}/edit"%></td>
    </tr>
    <%end%>
  </tbody>
</table>
